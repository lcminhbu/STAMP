@page
@model VotingModel
@{
    ViewData["Title"] = "Bình Chọn";
}

<header>
    <link rel="stylesheet" href="~/css/voting.css" asp-append-version="true"/>
    <link rel="stylesheet" href="~/css/searchbar-style.css" asp-append-version="true"/>
</header>
<body>
    <script src="~/js/common.js"></script>
    @* Banner *@
    <div class="banner-container grey-background">
        <img class="stamplogo" src="~/image/Voting/stamplogo.png" alt="">
    </div>
    @* Search box *@
    <div class="search-box">
        <div class="search">
            <button class="search-btn" onclick="">
                <img class="search-img" src="~/image/Ranking/search-normal.png"/>
            </button>
            <input type="text" id="trigger" class="search-input" placeholder="Tìm kiếm"/>
        </div>
    </div>
    @* Top 20 *@
    <h1 class="line-bottom blue-color">Top 20</h1>
    <div class="container-fluid horizontal-scrollable">
        <div class="row flex-nowrap">
            <div class="col-4 container-fluid" >
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 1</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 2</h2>
                    </div>
                </div>
            </div>
            <div class="col-4 container-fluid" >
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 3</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 4</h2>
                    </div>
                </div>
            </div>
            <div class="col-4 container-fluid" >
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 5</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 6</h2>
                    </div>
                </div>
            </div>
            <div class="col-4 container-fluid" >
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 7</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 8</h2>
                    </div>
                </div>
            </div>
            <div class="col-4 container-fluid" >
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 9</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 10</h2>
                    </div>
                </div>
            </div>
            <div class="col-4 container-fluid" >
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 11</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 12</h2>
                    </div>
                </div>
            </div>
            <div class="col-4 container-fluid" >
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 13</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 14</h2>
                    </div>
                </div>
            </div>
            <div class="col-4 container-fluid" >
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 15</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 16</h2>
                    </div>
                </div>
            </div>
            <div class="col-4 container-fluid" >
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 17</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 18</h2>
                    </div>
                </div>
            </div>
            <div class="col-4 container-fluid" >
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 19</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm 20</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @* STAMP 2023 *@
    <h1 class="line-bottom blue-color">S.T.A.M.P 2023</h1>
    <div id="data-container" class="container-fluid">
        <div class="row">
            <div class="col-4" >
                <div class="submission-box">
                    <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 1</h2>
                </div>
            </div>
            <div class="col-4">
                <div class="submission-box">
                        <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 2</h2>
                </div>
            </div>
            <div class="col-4">
                <div class="submission-box">
                        <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 3</h2>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-4">
                <div class="submission-box">
                        <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 4</h2>
                </div>
            </div>
            <div class="col-4">
                <div class="submission-box">
                        <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 5</h2>
                </div>
            </div>
            <div class="col-4">
                <div class="submission-box">
                        <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 6</h2>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-4" >
                <div class="submission-box">
                    <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 7</h2>
                </div>
            </div>
            <div class="col-4">
                <div class="submission-box">
                        <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 8</h2>
                </div>
            </div>
            <div class="col-4">
                <div class="submission-box">
                        <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 9</h2>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-4">
                <div class="submission-box">
                        <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 10</h2>
                </div>
            </div>
            <div class="col-4">
                <div class="submission-box">
                        <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 11</h2>
                </div>
            </div>
            <div class="col-4">
                <div class="submission-box">
                        <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 12</h2>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-4" >
                <div class="submission-box">
                    <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 13</h2>
                </div>
            </div>
            <div class="col-4">
                <div class="submission-box">
                        <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 14</h2>
                </div>
            </div>
            <div class="col-4">
                <div class="submission-box">
                        <div class="stamp-frame">
                        <img src="~/image/stamp.png" alt="" class="stamp-img">
                    </div>
                    <h2 class="stamp-name">Tên tác phẩm 15</h2>
                </div>
            </div>
        </div>
    </div>
    @* Chuyển nội dung *@
    <div id="pagination">
    </div>

    @* Popup *@
    <div id="overlay" class="display-none"></div>
    <div id="popup" class="container display-none">
        <div class="row">
            <div class="col-6 submission-info">
                <p class="title">Tên tác phẩm</p>
                <p class="author">Tên tác giả</p>
                <p class="description">Mô tả tác phẩm</p>
            </div>
            <div class="col-6">
                <div class="stamp-frame">
                    <img src="~/image/stamp.png" alt="" class="stamp-img">
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-4">
                            <button class="like-btn">
                                <p class="like-number">00</p>
                                <img src="~/icon/like.png" alt="" class="like-icon">
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="link-btn">
                                <img src="~/icon/link.png" alt="" class="link-icon">
                            </button>
                        </div>
                        <div class="col-4">
                            <button class="facebook-btn">
                                <img src="~/icon/f.png" alt="" class="">
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @* Popup script *@
    <script>
        const cards = document.getElementsByClassName("submission-box");
        const popup = document.getElementById("popup");
        const body = document.querySelector("body");
        const overlay = document.getElementById("overlay");
        for (var i = 0; i<cards.length; i++) {
            var card = cards[i];
            card.addEventListener("click", function (){
                var stamp = this.getElementsByClassName("stamp-name")[0];
                var title = stamp.innerText;
                popup.classList.remove("display-none");
                var popup_title = popup.getElementsByClassName("title")[0];
                var popup_author = popup.getElementsByClassName("author")[0];
                var popup_description = popup.getElementsByClassName("description")[0];
                var popup_frame = popup.getElementsByClassName("stamp-frame")[0];
                
                resize_frame();
                popup_title.innerText = title;
                @* Code để lấy tên tác giả và tác phẩm từ database *@
                popup_author.innerText = "Tên tác giả của tác phẩm "+title;
                popup_description.innerText = "Mô tả của tác phẩm:\n" + title;
                overlay.classList.remove("display-none");
                body.style.overflow = "hidden";
            })
        };
        overlay.addEventListener("click", function() {
            popup.classList.add("display-none");
            overlay.classList.add("display-none");
            body.style.overflow = "auto";
        });
    </script>

    @* Pagination script *@
    <script>
        @* Viết script tìm tổng số bài thi ở đây. Ở đây đang gán cứng là 300 bài *@
        const total_data_count = 300;
        const item_per_page = 15;
        const page_number = Math.ceil(total_data_count/item_per_page);
        
        let current_page = 1;
        let is_loading = false;
        function fetchData(page) {
            if (is_loading) {
                return;
            }
            is_loading = true;
            
            @* Code để fetch 15 item tương ứng từ database. Ở đây đang giả lập dữ liệu giống với figma *@
            
            @* Kết thúc code fetch *@
            
            const data_container = document.getElementById("data-container");
            data_container.innerHTML = "";
            var counter = 0;
            var row_element;

            @* Nên chuyển từ lặp bằng số item sang lặp bằng data fetch được *@
            for (var i = 0; i < item_perPage; i ++) {
                if (counter===0) {
                    row_element = document.createElement('div');
                    row_element.classList.add('row');
                }
                const item_html = `
                <div class="col-4">
                    <div class="submission-box">
                        <div class="stamp-frame">
                            <img src="~/image/stamp.png" alt="" class="stamp-img">
                        </div>
                        <h2 class="stamp-name">Tên tác phẩm ${i}</h2>
                    </div>
                </div>`;
                const item_element = document.createElement('div');
                item_element.innerHTML = item_html;
                row_element.appendChild(item_element);
                @* Hoặc khi đã hết data hoặc khi đủ 3 item trên 1 dòng *@
                if (counter === 3) {
                    data_container.appendChild(row_element);
                    counter = 0;
                }
            }
            current_page = page;
        }

        function updatePage () {
            const pagination = document.getElementById("pagination");
            pagination.innerHTML = "";

            @* Tạo nút previous *@
            const prev_btn = document.createElement("div");
            prev_btn.textContent = "Previous";
            prev_btn.addEventListener("click", ()=>{
                if (current_page > 1) {
                    fetchData(current_page - 1);
                }
            });
            pagination.appendChild(prev_btn);

            if (page_number <= 7) {
                for (var i=0; i<7; i++) {
                    var page_btn = document.createElement("div");
                    page_btn.textContent = i;
                    if (i !=current_page) {
                        page_btn.addEventListener("click", ()=>{
                        fetchData(i);
                        });
                    }
                    pagination.appendChild(page_btn);
                }
            }
            else {
                var page_btns = []
                for (var i=0; i<8; i++) {
                    page_btns.push(document.createElement("div"));
                }

                page_btns[1].textContent = 1;
                if (current_page != 1) {
                    page_btns[1].addEventListener("click", ()=>{
                        fetchData(1);
                    })
                }
                page_btns[7].textContent = page_number;
                if (current_page != page_number) {
                    page_btns[7].addEventListener("click", ()=>{
                        fetchData(page_number);
                    });
                }
                if (current_page <= 4) {
                    page_btns[2].textContent = 2;
                    page_btns[3].textContent = 3;
                    page_btns[4].textContent = 4;
                    page_btns[5].textContent = 5;
                    page_btns[6].textContent = "...";
                    for (var i=2; i<7;i++) {
                        var id = page_btns[i].textContent
                        if (current_page != page_btns[i].id) {
                            page_btns[i].addEventListener("click", ()=>{
                                fetchData(id);
                            });
                        }
                    }
                }
                else if (current_page >= page_number-3) {
                    page_btns[2].textContent = "...";
                    page_btns[3].textContent = page_number-4;
                    page_btns[4].textContent = page_number-3;
                    page_btns[5].textContent = page_number-2;
                    page_btns[6].textContent = page_number-1;
                    for (var i=2; i<7;i++) {
                        var id = page_btns[i].textContent
                        if (current_page != page_btns[i].id) {
                            page_btns[i].addEventListener("click", ()=>{
                                fetchData(id);
                            });
                        }
                    }
                }
                else {
                    page_btns[2].textContent = "...";
                    page_btns[3].textContent = current_page-1;
                    page_btns[4].textContent = current_page;
                    page_btns[5].textContent = current_page+1;
                    page_btns[6].textContent = "...";
                    for (var i=2; i<7;i++) {
                        var id = page_btns[i].textContent
                        if (current_page != page_btns[i].id) {
                            page_btns[i].addEventListener("click", ()=>{
                                fetchData(id);
                            });
                        }
                    }
                }
            }
            console.log(page_btns);
            console.log("ok");
            for (var i=1; i<8; i++) {
                pagination.appendChild(page_btns[i]);
            }
            @* Tạo nút next *@
            const next_btn = document.createElement("div");
            next_btn.textContent = "Next";
            next_btn.addEventListener("click", ()=>{
                if (current_page < page_number) {
                    fetchData(current_page + 1);
                }
            });
            pagination.appendChild(next_btn);
        }
    </script>
</body>
